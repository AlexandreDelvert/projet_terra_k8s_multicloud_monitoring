- name: Bump version based on changes
  run: |
    bash bump_version.sh
    git config --global user.email "actions@github.com"
    git config --global user.name "github-actions"
    git add version.txt
    git commit -m "chore: bump version"
    git push https://x-access-token:${{ secrets.GH_TOKEN }}@github.com/${{ github.repository }} HEAD:main

- name: Create and push Git tag
  run: |
    version=$(cat version.txt)
    git tag "v$version"
    git push https://x-access-token:${{ secrets.GH_TOKEN }}@github.com/${{ github.repository }} --tags

- name: Create GitHub Release
  uses: softprops/action-gh-release@v1
  with:
    tag_name: v${{ steps.version.outputs.VERSION }}
  env:
    GITHUB_TOKEN: ${{ secrets.GH_TOKEN }}

- name: Bump version and output
  id: version
  run: |
    bash bump_version.sh
    version=$(cat version.txt)
    echo "VERSION=$version" >> $GITHUB_OUTPUT

